import{r as n,q as I,s as C,j as e,S as j,C as S,x as y,B as m}from"./index-COc_9EsS.js";import{I as w}from"./input-CtDZ1l8n.js";import{L as t}from"./label-Dwl52tZZ.js";import{B as _}from"./badge-jxMiL_t9.js";import{T as M,a as V,b as U,c,d as z,e as d}from"./table-BBQAnNUa.js";import{D as b,a as L,b as T,c as D,d as E,f as B}from"./dialog-DXrd4U38.js";import{S as O,a as P,b as $,c as G,d as f}from"./select-DRr0sP0p.js";import{U as J}from"./users-CStnP4Kw.js";import{S as K}from"./search-_tnmDF7W.js";import{M as Q}from"./mail-C1qg-MLr.js";import{C as W}from"./clock-DIS6wdkS.js";import{E as X}from"./eye-BWg0lIGw.js";import{S as Y}from"./square-pen-hqvfta-z.js";import"./index-s0IQ3itP.js";import"./index-CUsEfDx6.js";import"./index-DUvJja7M.js";import"./chevron-down-Q_a8tIzl.js";import"./chevron-up-DP1NMAhj.js";const Z=()=>{const[R,k]=n.useState([]),[A,p]=n.useState(!0),[x,F]=n.useState(""),[l,q]=n.useState(null),[r,o]=n.useState(null),{toast:h}=I();n.useEffect(()=>{g()},[]);const g=async()=>{try{p(!0);const{data:s,error:a}=await C.from("profiles").select("*").order("created_at",{ascending:!1});if(a)throw a;k(s||[])}catch(s){h({title:"Error",description:s.message,variant:"destructive"})}finally{p(!1)}},H=async(s,a)=>{try{const{error:i}=await C.from("profiles").update(a).eq("id",s);if(i)throw i;h({title:"Success",description:"User updated successfully",variant:"default"}),o(null),g()}catch(i){h({title:"Error",description:i.message,variant:"destructive"})}},u=R.filter(s=>{var a,i;return((a=s.email)==null?void 0:a.toLowerCase().includes(x.toLowerCase()))||((i=s.full_name)==null?void 0:i.toLowerCase().includes(x.toLowerCase()))}),N=s=>{const a={super_admin:"destructive",admin:"default",user:"secondary"};return e.jsx(_,{variant:a[s]||"secondary",children:s})},v=s=>e.jsx(_,{variant:s==="login"?"default":"secondary",children:s==="login"?"Online":"Offline"});return A?e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{className:"h-8 w-64"}),e.jsx(j,{className:"h-10 w-full"}),e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,a)=>e.jsx(j,{className:"h-16 w-full"},a))})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(J,{className:"h-6 w-6"}),"Users Management"]}),e.jsxs("p",{className:"text-muted-foreground",children:[u.length," users"]})]})}),e.jsx(S,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Search users by email or name...",value:x,onChange:s=>F(s.target.value),className:"pl-10"})]})})}),e.jsx(S,{children:e.jsxs(y,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(M,{children:[e.jsx(V,{children:e.jsxs(U,{children:[e.jsx(c,{children:"User"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Last Login"}),e.jsx(c,{children:"Login Count"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(z,{children:u.map(s=>e.jsxs(U,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:s.full_name?s.full_name.slice(0,2).toUpperCase():s.email.slice(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.full_name||"No Name"}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"}),s.email]})]})]})}),e.jsx(d,{children:N(s.role)}),e.jsx(d,{children:v(s.login_status)}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(W,{className:"h-3 w-3"}),s.last_login?new Date(s.last_login).toLocaleDateString():"Never"]})}),e.jsx(d,{children:s.login_count||0}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(b,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>q(s),children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"View"]})}),e.jsxs(T,{className:"max-w-2xl",children:[e.jsxs(D,{children:[e.jsx(E,{children:"User Details"}),e.jsx(B,{children:"Complete information for this user account"})]}),l&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-muted-foreground",children:"Full Name"}),e.jsx("p",{className:"text-sm",children:l.full_name||"Not provided"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-sm",children:l.email})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-muted-foreground",children:"Role"}),e.jsx("div",{className:"mt-1",children:N(l.role)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx("div",{className:"mt-1",children:v(l.login_status)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"text-sm",children:new Date(l.created_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-muted-foreground",children:"Last Login"}),e.jsx("p",{className:"text-sm",children:l.last_login?new Date(l.last_login).toLocaleString():"Never"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-muted-foreground",children:"Total Logins"}),e.jsx("p",{className:"text-sm",children:l.login_count||0})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-muted-foreground",children:"Today's Logins"}),e.jsx("p",{className:"text-sm",children:l.today_login_count||0})]})]})})]})]}),e.jsxs(b,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(m,{size:"sm",variant:"default",onClick:()=>o(s),children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Edit"]})}),e.jsxs(T,{children:[e.jsxs(D,{children:[e.jsx(E,{children:"Edit User"}),e.jsx(B,{children:"Update user information and permissions"})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"fullName",children:"Full Name"}),e.jsx(w,{id:"fullName",value:r.full_name||"",onChange:a=>o({...r,full_name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"role",children:"Role"}),e.jsxs(O,{value:r.role,onValueChange:a=>o({...r,role:a}),children:[e.jsx(P,{children:e.jsx($,{placeholder:"Select role"})}),e.jsxs(G,{children:[e.jsx(f,{value:"user",children:"User"}),e.jsx(f,{value:"admin",children:"Admin"}),e.jsx(f,{value:"super_admin",children:"Super Admin"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",onClick:()=>o(null),children:"Cancel"}),e.jsx(m,{onClick:()=>H(r.id,{full_name:r.full_name,role:r.role}),children:"Save Changes"})]})]})]})]})]})})]},s.id))})]})}),u.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No users found"})]})})]})},ge=()=>e.jsx(Z,{});export{ge as default};
