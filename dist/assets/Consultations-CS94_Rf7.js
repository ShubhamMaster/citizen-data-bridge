import{r as a,q as R,j as e,S as h,B as N,C as c,v as x,w as u,x as o,s as C}from"./index-COc_9EsS.js";import{I as B}from"./input-CtDZ1l8n.js";import{B as D}from"./badge-jxMiL_t9.js";import{T as A,a as M,b as y,c as l,d as k,e as n}from"./table-BBQAnNUa.js";import{S as z,a as H,b as I,c as V,d as S}from"./select-DRr0sP0p.js";import{C as Y}from"./calendar-CSB8LMDL.js";import{R as U}from"./refresh-cw-DDwdgVYR.js";import{S as G}from"./search-_tnmDF7W.js";import{E as J}from"./eye-BWg0lIGw.js";import{T as K}from"./trash-2-CCkRIFkE.js";import"./index-s0IQ3itP.js";import"./index-CUsEfDx6.js";import"./index-DUvJja7M.js";import"./chevron-down-Q_a8tIzl.js";import"./chevron-up-DP1NMAhj.js";const ce=()=>{const[r,b]=a.useState([]),[j,g]=a.useState([]),[T,v]=a.useState(!0),[i,q]=a.useState(""),[d,E]=a.useState("all"),{toast:p}=R(),f=async()=>{try{v(!0);const{data:s,error:t}=await C.from("consultation_requests").select("*").order("created_at",{ascending:!1});if(t)throw t;b(s||[]),g(s||[])}catch(s){console.error("Error fetching consultations:",s),p({title:"Error",description:"Failed to fetch consultations",variant:"destructive"})}finally{v(!1)}};a.useEffect(()=>{f()},[]),a.useEffect(()=>{let s=r.filter(t=>{var w;const m=t.name.toLowerCase().includes(i.toLowerCase())||t.email.toLowerCase().includes(i.toLowerCase())||((w=t.company)==null?void 0:w.toLowerCase().includes(i.toLowerCase())),L=d==="all"||t.consultation_type===d;return m&&L});g(s)},[r,i,d]);const _=async s=>{try{const{error:t}=await C.from("consultation_requests").delete().eq("id",s);if(t)throw t;p({title:"Success",description:"Consultation deleted successfully",variant:"default"}),f()}catch{p({title:"Error",description:"Failed to delete consultation",variant:"destructive"})}},F=[...new Set(r.map(s=>s.consultation_type).filter(Boolean))];return T?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{className:"h-8 w-48"}),e.jsx(h,{className:"h-10 w-32"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(3)].map((s,t)=>e.jsx(h,{className:"h-24"},t))}),e.jsx(h,{className:"h-96"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(Y,{className:"h-8 w-8"}),"Consultation Requests"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and review consultation requests"})]}),e.jsxs(N,{onClick:f,variant:"outline",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(c,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"Total Requests"})}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.length})})]}),e.jsxs(c,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"This Month"})}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.filter(s=>{const t=new Date(s.created_at),m=new Date;return t.getMonth()===m.getMonth()&&t.getFullYear()===m.getFullYear()}).length})})]}),e.jsxs(c,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"Unique Companies"})}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set(r.map(s=>s.company).filter(Boolean)).size})})]})]}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-64",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search consultations...",value:i,onChange:s=>q(s.target.value),className:"pl-10"})]}),e.jsxs(z,{value:d,onValueChange:E,children:[e.jsx(H,{className:"w-48",children:e.jsx(I,{placeholder:"Filter by type"})}),e.jsxs(V,{children:[e.jsx(S,{value:"all",children:"All Types"}),F.map(s=>e.jsx(S,{value:s,children:s},s))]})]})]})})}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(u,{children:["Consultation Requests (",j.length,")"]})}),e.jsxs(o,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(A,{children:[e.jsx(M,{children:e.jsxs(y,{children:[e.jsx(l,{children:"Name"}),e.jsx(l,{children:"Email"}),e.jsx(l,{children:"Company"}),e.jsx(l,{children:"Type"}),e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(k,{children:j.map(s=>e.jsxs(y,{children:[e.jsx(n,{className:"font-medium",children:s.name}),e.jsx(n,{children:s.email}),e.jsx(n,{children:s.company||"N/A"}),e.jsx(n,{children:s.consultation_type&&e.jsx(D,{variant:"outline",children:s.consultation_type})}),e.jsx(n,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>_(s.id),children:e.jsx(K,{className:"h-4 w-4"})})]})})]},s.id))})]})}),j.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No consultation requests found"})]})]})]})};export{ce as default};
