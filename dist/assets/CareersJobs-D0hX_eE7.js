import{q as b,A as f,s as j,r as y,j as e,C as g,v as C,w as S,y as _,x as v,B as w,b as F}from"./index-COc_9EsS.js";import{o as E,s as t,u as T,F as A,a as i,b as n,c as l,d as c,e as m,t as N}from"./form-BgAqJHVE.js";import{H as P,F as I}from"./Footer-CyJ0ouTo.js";import{U as L}from"./UniformHeroSection-DgU-VhiN.js";import{I as x}from"./input-CtDZ1l8n.js";import{T as q}from"./textarea-CqUjQhD9.js";import{S as k,a as H,b as J,c as R,d as U}from"./select-DRr0sP0p.js";import{u as V,a as D}from"./useEmailConfirmation-Dx1rH9dT.js";import{u as Q}from"./useQuery-08ZbY9E2.js";import"./label-Dwl52tZZ.js";import"./chevron-down-Q_a8tIzl.js";import"./mail-C1qg-MLr.js";import"./phone-BZMpqAbR.js";import"./map-pin-BhWPv-Lk.js";import"./index-s0IQ3itP.js";import"./index-CUsEfDx6.js";import"./index-DUvJja7M.js";import"./chevron-up-DP1NMAhj.js";const B=()=>{const{toast:d}=b(),u=f(),{sendConfirmationEmail:p}=V();return D({mutationFn:async a=>{const{error:s}=await j.from("applications").insert([a]);if(s)throw s;await p({formType:"salary",name:a.application_data.name,email:a.application_data.email,phone:a.application_data.phone,message:`Job application for position ID: ${a.job_id}`})},onSuccess:()=>{d({title:"Application Submitted!",description:"Your job application has been submitted successfully. We'll review it and get back to you soon."}),u.invalidateQueries({queryKey:["applications"]})},onError:a=>{console.error("Error submitting job application:",a),d({title:"Error",description:"There was an error submitting your application. Please try again.",variant:"destructive"})}})},K=E({name:t().min(2,"Name must be at least 2 characters"),email:t().email("Please enter a valid email address"),phone:t().optional(),job_id:t().min(1,"Please select a job position"),resume:t().url("Please enter a valid resume URL").optional(),cover_letter:t().min(10,"Cover letter must be at least 10 characters")}),ce=()=>{const[d,u]=y.useState(!1),p=B(),{data:a=[]}=Q({queryKey:["jobs"],queryFn:async()=>{const{data:r,error:o}=await j.from("jobs").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(o)throw console.error("Error fetching jobs:",o),o;return r}}),s=T({resolver:N(K),defaultValues:{name:"",email:"",phone:"",job_id:"",resume:"",cover_letter:""}}),h=async r=>{u(!0);try{await p.mutateAsync({job_id:parseInt(r.job_id),user_id:r.email,application_data:{name:r.name,email:r.email,phone:r.phone,resume:r.resume,cover_letter:r.cover_letter},data_source:"website"}),s.reset()}catch(o){console.error("Application submission failed:",o)}finally{u(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(P,{}),e.jsxs("main",{className:"flex-1",children:[e.jsx(L,{title:"Job Applications",subtitle:"Apply for exciting career opportunities at Civora Nexus"}),e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(g,{children:[e.jsxs(C,{children:[e.jsx(S,{children:"Apply for a Position"}),e.jsx(_,{children:"Fill out the form below to apply for one of our open positions."})]}),e.jsx(v,{children:e.jsx(A,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(h),className:"space-y-6",children:[e.jsx(i,{control:s.control,name:"name",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Full Name *"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Enter your full name",...r})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"email",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Email Address *"}),e.jsx(c,{children:e.jsx(x,{type:"email",placeholder:"Enter your email",...r})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"phone",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Phone Number"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Enter your phone number",...r})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"job_id",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Position *"}),e.jsxs(k,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(c,{children:e.jsx(H,{children:e.jsx(J,{placeholder:"Select a position"})})}),e.jsx(R,{children:a.map(o=>e.jsxs(U,{value:o.id.toString(),children:[o.title," - ",o.department]},o.id))})]}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"resume",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Resume URL"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Link to your resume (e.g., Google Drive, LinkedIn)",...r})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"cover_letter",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Cover Letter *"}),e.jsx(c,{children:e.jsx(q,{placeholder:"Tell us why you're interested in this position and what makes you a great fit...",className:"min-h-[120px]",...r})}),e.jsx(m,{})]})}),e.jsx(w,{type:"submit",className:"w-full",disabled:d||p.isPending,children:d||p.isPending?"Submitting...":"Submit Application"})]})})})]})})})]}),e.jsx(I,{}),e.jsx(F,{})]})};export{ce as default};
