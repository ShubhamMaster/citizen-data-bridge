import{r as a,q as L,s as j,j as e,B as r,C as _,x as C,v as O,w as B}from"./index-COc_9EsS.js";import{I as l}from"./input-CtDZ1l8n.js";import{T as H,a as M,b as N,c as m,d as V,e as u}from"./table-BBQAnNUa.js";import{S as q,a as z,b as P,c as U,d as w}from"./select-DRr0sP0p.js";import{F as $}from"./file-text-BWAGHgaU.js";import{P as G}from"./plus-DarcKYWw.js";import{S as J}from"./search-_tnmDF7W.js";import{R as K}from"./refresh-cw-DDwdgVYR.js";import{D as Q}from"./download-CpAEjvKm.js";import{T as W}from"./trash-2-CCkRIFkE.js";import"./index-s0IQ3itP.js";import"./index-CUsEfDx6.js";import"./index-DUvJja7M.js";import"./chevron-down-Q_a8tIzl.js";import"./chevron-up-DP1NMAhj.js";const ue=()=>{const[h,g]=a.useState([]),[D,f]=a.useState(!0),[x,b]=a.useState(""),[v,S]=a.useState([]),[o,T]=a.useState(""),[F,p]=a.useState(!1),[n,y]=a.useState({company_id:"",document_name:"",doc_type:"",document_url:"",document_number:""}),{toast:c}=L();a.useEffect(()=>{i()},[]),a.useEffect(()=>{let s=h.filter(t=>t.document_name.toLowerCase().includes(x.toLowerCase())&&(o===""||t.company_id===o));S(s)},[h,x,o]);const i=async()=>{try{f(!0);const{data:s,error:t}=await j.from("civora_nexus_documents").select("*").order("created_at",{ascending:!1});if(t)throw t;g(s||[])}catch{c({title:"Error",description:"Failed to fetch documents",variant:"destructive"})}finally{f(!1)}},d=s=>{const{name:t,value:R}=s.target;y(A=>({...A,[t]:R}))},E=async()=>{try{const s={...n,document_id:`DOC_${Date.now()}`},{error:t}=await j.from("civora_nexus_documents").insert([s]);if(t)throw t;c({title:"Success",description:"Document created successfully",variant:"default"}),i(),p(!1),y({company_id:"",document_name:"",doc_type:"",document_url:"",document_number:""})}catch{c({title:"Error",description:"Failed to create document",variant:"destructive"})}},k=async s=>{try{const{error:t}=await j.from("civora_nexus_documents").delete().eq("document_id",s);if(t)throw t;c({title:"Success",description:"Document deleted successfully",variant:"default"}),i()}catch{c({title:"Error",description:"Failed to delete document",variant:"destructive"})}},I=[...new Set(h.map(s=>s.company_id))];return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"loader"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx($,{className:"h-8 w-8"}),"Documents"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage company documents"})]}),e.jsxs(r,{onClick:()=>p(!0),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add Document"]})]}),e.jsx(_,{children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-64",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(l,{placeholder:"Search documents...",value:x,onChange:s=>b(s.target.value),className:"pl-10"})]}),e.jsxs(q,{value:o,onValueChange:T,children:[e.jsx(z,{className:"w-48",children:e.jsx(P,{placeholder:"Filter by Company"})}),e.jsxs(U,{children:[e.jsx(w,{value:"",children:"All Companies"}),I.map(s=>e.jsx(w,{value:s,children:s},s))]})]}),e.jsxs(r,{onClick:i,variant:"outline",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})})}),e.jsxs(_,{children:[e.jsx(O,{children:e.jsxs(B,{children:["All Documents (",v.length,")"]})}),e.jsx(C,{children:e.jsxs(H,{children:[e.jsx(M,{children:e.jsxs(N,{children:[e.jsx(m,{children:"Name"}),e.jsx(m,{children:"Type"}),e.jsx(m,{children:"Company ID"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(V,{children:v.map(s=>e.jsxs(N,{children:[e.jsx(u,{className:"font-medium",children:s.document_name}),e.jsx(u,{children:s.doc_type}),e.jsx(u,{children:s.company_id}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:s.document_url,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"View"]})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>k(s.document_id),children:e.jsx(W,{className:"h-4 w-4"})})]})})]},s.document_id))})]})})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Add New Document"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(l,{placeholder:"Document Name",name:"document_name",value:n.document_name,onChange:d,className:"mb-4"}),e.jsx(l,{placeholder:"Document Type",name:"doc_type",value:n.doc_type,onChange:d,className:"mb-4"}),e.jsx(l,{placeholder:"Document URL",name:"document_url",value:n.document_url,onChange:d,className:"mb-4"}),e.jsx(l,{placeholder:"Company ID",name:"company_id",value:n.company_id,onChange:d,className:"mb-4"})]}),e.jsxs("div",{className:"items-center px-4 py-3",children:[e.jsx(r,{variant:"default",onClick:E,children:"Create Document"}),e.jsx(r,{variant:"ghost",onClick:()=>p(!1),className:"ml-2",children:"Cancel"})]})]})})})]})};export{ue as default};
