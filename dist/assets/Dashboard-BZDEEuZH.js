import{c as A,r as m,j as s,d as N,ab as S,q as T,C as f,v as j,w as b,B as _,x as p,s as c}from"./index-COc_9EsS.js";import{u as C}from"./useQuery-08ZbY9E2.js";import{B as D}from"./badge-jxMiL_t9.js";import{R as k}from"./refresh-cw-DDwdgVYR.js";import{T as I}from"./triangle-alert-thb70v1D.js";import{C as L}from"./circle-check-big-CT8teBUW.js";import{L as w}from"./Loading-B8USftwP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=A("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),z=S("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),q=m.forwardRef(({className:n,variant:i,...r},o)=>s.jsx("div",{ref:o,role:"alert",className:N(z({variant:i}),n),...r}));q.displayName="Alert";const F=m.forwardRef(({className:n,...i},r)=>s.jsx("h5",{ref:r,className:N("mb-1 font-medium leading-none tracking-tight",n),...i}));F.displayName="AlertTitle";const R=m.forwardRef(({className:n,...i},r)=>s.jsx("div",{ref:r,className:N("text-sm [&_p]:leading-relaxed",n),...i}));R.displayName="AlertDescription";const H=()=>{const[n,i]=m.useState([]),[r,o]=m.useState(!1),{toast:v}=T(),h=async()=>{o(!0);const e=[];try{const{data:t,error:a}=await c.from("profiles").select("count").limit(1);if(a)throw a;e.push({name:"Database Connection",status:"success",message:"Database is accessible"})}catch(t){e.push({name:"Database Connection",status:"error",message:"Database connection failed",details:t.message})}try{const{data:t,error:a}=await c.from("api_keys").select("*");if(a)throw a;const u=t==null?void 0:t.find(E=>E.key_name==="email");u&&u.is_active?e.push({name:"Email API Configuration",status:"success",message:"Email API key is configured and active"}):e.push({name:"Email API Configuration",status:"warning",message:"Email API key not found or inactive"})}catch(t){e.push({name:"API Keys Configuration",status:"error",message:"Failed to check API keys",details:t.message})}try{const{data:t,error:a}=await c.functions.invoke("send-noreply-email",{body:{to:"test@example.com",subject:"Health Check Test",message:"This is a health check test email",isDryRun:!0}});if(a)throw a;e.push({name:"Email Function",status:"success",message:"Email function is working"})}catch(t){e.push({name:"Email Function",status:"error",message:"Email function failed",details:t.message})}const l=["contact_submissions","consultation_requests","collaboration_requests"];for(const t of l)try{const{data:a,error:u}=await c.from(t).select("count").limit(1);if(u)throw u;e.push({name:`${t} Table`,status:"success",message:`${t} table is accessible`})}catch(a){e.push({name:`${t} Table`,status:"error",message:`${t} table check failed`,details:a.message})}i(e),o(!1);const d=e.filter(t=>t.status==="error").length,g=e.filter(t=>t.status==="warning").length;v({title:"Health Check Complete",description:`${e.length-d-g} passed, ${g} warnings, ${d} errors`,variant:d>0?"destructive":"default"})},x=e=>{switch(e){case"success":return s.jsx(L,{className:"h-4 w-4 text-green-500"});case"error":return s.jsx($,{className:"h-4 w-4 text-red-500"});case"warning":return s.jsx(I,{className:"h-4 w-4 text-yellow-500"});default:return null}},y=e=>{switch(e){case"success":return"default";case"error":return"destructive";case"warning":return"secondary";default:return"outline"}};return s.jsxs(f,{children:[s.jsx(j,{children:s.jsxs(b,{className:"flex items-center gap-2",children:["System Health Check",s.jsxs(_,{onClick:h,disabled:r,size:"sm",variant:"outline",children:[r?s.jsx(k,{className:"h-4 w-4 animate-spin"}):s.jsx(k,{className:"h-4 w-4"}),r?"Running...":"Run Check"]})]})}),s.jsx(p,{children:n.length===0?s.jsx(q,{children:s.jsx(R,{children:'Click "Run Check" to test system components and integrations.'})}):s.jsx("div",{className:"space-y-4",children:n.map((e,l)=>s.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[x(e.status),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.name}),s.jsx("div",{className:"text-sm text-muted-foreground",children:e.message}),e.details&&s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.details})]})]}),s.jsx(D,{variant:y(e.status),children:e.status})]},l))})})]})},G=()=>{const{data:n,isLoading:i,error:r}=C({queryKey:["contactSubmissions"],queryFn:async()=>{const{data:t,error:a}=await c.from("contact_submissions").select("*");if(a)throw console.error("Error fetching contact submissions:",a),a;return t}}),{data:o,isLoading:v,error:h}=C({queryKey:["consultationRequests"],queryFn:async()=>{const{data:t,error:a}=await c.from("consultation_requests").select("*");if(a)throw console.error("Error fetching consultation requests:",a),a;return t}}),{data:x,isLoading:y,error:e}=C({queryKey:["collaborationRequests"],queryFn:async()=>{const{data:t,error:a}=await c.from("collaboration_requests").select("*");if(a)throw console.error("Error fetching collaboration requests:",a),a;return t}}),l=n?n.length:0,d=o?o.length:0,g=x?x.length:0;return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Welcome back, Administrator"})]}),s.jsx("div",{className:"mb-8",children:s.jsx(H,{})}),s.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[s.jsxs(f,{children:[s.jsx(j,{children:s.jsx(b,{children:"Contact Submissions"})}),s.jsxs(p,{children:[s.jsx("div",{className:"text-2xl font-semibold",children:l}),r&&s.jsxs("div",{className:"text-red-500",children:["Error: ",r.message]}),i&&s.jsx(w,{size:"sm",className:"min-h-[40px]"})]})]}),s.jsxs(f,{children:[s.jsx(j,{children:s.jsx(b,{children:"Consultation Requests"})}),s.jsxs(p,{children:[s.jsx("div",{className:"text-2xl font-semibold",children:d}),h&&s.jsxs("div",{className:"text-red-500",children:["Error: ",h.message]}),v&&s.jsx(w,{size:"sm",className:"min-h-[40px]"})]})]}),s.jsxs(f,{children:[s.jsx(j,{children:s.jsx(b,{children:"Collaboration Requests"})}),s.jsxs(p,{children:[s.jsx("div",{className:"text-2xl font-semibold",children:g}),e&&s.jsxs("div",{className:"text-red-500",children:["Error: ",e.message]}),y&&s.jsx(w,{size:"sm",className:"min-h-[40px]"})]})]})]})]})};export{G as default};
