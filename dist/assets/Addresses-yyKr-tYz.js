import{r as n,j as e,B as j,C as u,v as p,w as f,x as _,s as w,q as y}from"./index-COc_9EsS.js";import{I as l}from"./input-CtDZ1l8n.js";import{L as o}from"./label-Dwl52tZZ.js";import{T as B,a as I,b as z,c as x,d as q,e as h}from"./table-BBQAnNUa.js";import{M as H}from"./map-pin-BhWPv-Lk.js";import{R as M}from"./refresh-cw-DDwdgVYR.js";import{S as Z}from"./search-_tnmDF7W.js";import{P as O}from"./plus-DarcKYWw.js";import{P as U}from"./pencil-CLmt3uQu.js";import{T as $}from"./trash-2-CCkRIFkE.js";const re=()=>{const[m,F]=n.useState([]),[E,N]=n.useState([]),[C,A]=n.useState(!0),[d,D]=n.useState(""),[P,g]=n.useState(!1),[r,i]=n.useState({company_id:"",address_line1:"",address_line2:"",city:"",state:"",zip_code:"",country:"",is_primary:!1}),v=async()=>{try{A(!0);const{data:s,error:a}=await w.from("civora_nexus_company_addresses").select("*").order("created_at",{ascending:!1});if(a)throw a;const c=(s||[]).map(t=>({address_id:t.address_id,company_id:t.company_id,address_line1:t.street_address,address_line2:t.area,city:t.city,state:t.state,zip_code:t.postal_code,country:t.country,is_primary:!1,created_at:t.created_at}));F(c),N(c)}catch(s){console.error("Error fetching addresses:",s),y().toast({title:"Error",description:"Failed to fetch addresses",variant:"destructive"})}finally{A(!1)}};n.useEffect(()=>{v()},[]),n.useEffect(()=>{const s=m.filter(a=>{var c,t,b,L,S,T;return((c=a.address_line1)==null?void 0:c.toLowerCase().includes(d.toLowerCase()))||((t=a.address_line2)==null?void 0:t.toLowerCase().includes(d.toLowerCase()))||((b=a.city)==null?void 0:b.toLowerCase().includes(d.toLowerCase()))||((L=a.state)==null?void 0:L.toLowerCase().includes(d.toLowerCase()))||((S=a.zip_code)==null?void 0:S.toLowerCase().includes(d.toLowerCase()))||((T=a.country)==null?void 0:T.toLowerCase().includes(d.toLowerCase()))});N(s)},[m,d]);const R=async()=>{try{g(!0);const s={address_id:`ADDR_${Date.now()}`,company_id:r.company_id,street_address:r.address_line1,area:r.address_line2,city:r.city,state:r.state,postal_code:r.zip_code,country:r.country,address_type:"Office"},{data:a,error:c}=await w.from("civora_nexus_company_addresses").insert([s]).select();if(c)throw c;y().toast({title:"Success",description:"Address created successfully",variant:"default"}),i({company_id:"",address_line1:"",address_line2:"",city:"",state:"",zip_code:"",country:"",is_primary:!1}),g(!1),v()}catch(s){console.error("Error creating address:",s),y().toast({title:"Error",description:"Failed to create address",variant:"destructive"})}},k=async s=>{try{const{error:a}=await w.from("civora_nexus_company_addresses").delete().eq("address_id",s);if(a)throw a;y().toast({title:"Success",description:"Address deleted successfully",variant:"default"}),v()}catch(a){console.error("Error deleting address:",a),y().toast({title:"Error",description:"Failed to delete address",variant:"destructive"})}};return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"loader"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"h-8 w-8"}),"Company Addresses"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage company addresses"})]}),e.jsxs(j,{onClick:v,variant:"outline",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(f,{className:"text-sm font-medium",children:"Total Addresses"})}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:m.length})})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(f,{className:"text-sm font-medium",children:"Primary Addresses"})}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:m.filter(s=>s.is_primary).length})})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(f,{className:"text-sm font-medium",children:"Unique Countries"})}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set(m.map(s=>s.country).filter(Boolean)).size})})]})]}),e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{children:"All Addresses"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(l,{placeholder:"Search addresses...",value:d,onChange:s=>D(s.target.value),className:"pl-10 w-64"})]}),e.jsxs(j,{onClick:()=>g(!0),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Add New"]})]})]})}),e.jsx(_,{children:e.jsxs(B,{children:[e.jsx(I,{children:e.jsxs(z,{children:[e.jsx(x,{children:"Address Line 1"}),e.jsx(x,{children:"City"}),e.jsx(x,{children:"State"}),e.jsx(x,{children:"Zip Code"}),e.jsx(x,{children:"Country"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(q,{children:E.map(s=>e.jsxs(z,{children:[e.jsx(h,{className:"font-medium",children:s.address_line1}),e.jsx(h,{children:s.city}),e.jsx(h,{children:s.state}),e.jsx(h,{children:s.zip_code}),e.jsx(h,{children:s.country}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{variant:"outline",size:"sm",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>k(s.address_id),children:e.jsx($,{className:"h-4 w-4"})})]})})]},s.address_id))})]})})]}),P&&e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(f,{children:"Add New Address"})}),e.jsx(_,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"company_id",children:"Company ID"}),e.jsx(l,{id:"company_id",value:r.company_id,onChange:s=>i({...r,company_id:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"address_line1",children:"Address Line 1"}),e.jsx(l,{id:"address_line1",value:r.address_line1,onChange:s=>i({...r,address_line1:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"address_line2",children:"Address Line 2"}),e.jsx(l,{id:"address_line2",value:r.address_line2,onChange:s=>i({...r,address_line2:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"city",children:"City"}),e.jsx(l,{id:"city",value:r.city,onChange:s=>i({...r,city:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"state",children:"State"}),e.jsx(l,{id:"state",value:r.state,onChange:s=>i({...r,state:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"zip_code",children:"Zip Code"}),e.jsx(l,{id:"zip_code",value:r.zip_code,onChange:s=>i({...r,zip_code:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"country",children:"Country"}),e.jsx(l,{id:"country",value:r.country,onChange:s=>i({...r,country:s.target.value})})]}),e.jsx(j,{onClick:R,disabled:C,children:C?"Creating...":"Create Address"})]})})]})]})};export{re as default};
